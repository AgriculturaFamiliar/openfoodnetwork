= render partial: "/admin/order_cycles/order_cycle_top_buttons"

- content_for :page_title do
  = t :edit_order_cycle

- payment_methods = order_cycle_distributors_payment_methods(@order_cycle)
- shipping_methods = order_cycle_distributors_shipping_methods(@order_cycle)

= form_for [main_app, :admin, @order_cycle], html: { class: "order_cycle" } do |f|

  = render 'wizard_progress'

  %fieldset.no-border-bottom
    %legend{ align: 'center'}= t('.checkout_options')

  = hidden_field_tag "order_cycle[selected_shipping_method_ids][]", ""

  .row
    .three.columns
      &nbsp;
    .ten.columns
      %table.checkout-options
        %thead
          %tr
            %th{ colspan: 2 }= t('.shipping_methods')
          %tr{ "data-controller": "select-all" }
            %td.text-center
              %label
                = check_box_tag "bla", nil, (shipping_methods - @order_cycle.shipping_methods).empty?, { "data-action": "change->select-all#toggleAll", "data-select-all-target": "all" }
                = "Select all"
            %td
              - if shipping_methods.any?
                - shipping_methods.each do |shipping_method|
                  %p
                    %label{ class: ("disabled" unless shipping_method.frontend?) }
                      = check_box_tag "order_cycle[selected_shipping_method_ids][]",
                          shipping_method.id, @order_cycle.shipping_methods.include?(shipping_method),
                          disabled: !shipping_method.frontend?,
                          id: "order_cycle_selected_shipping_method_ids_#{shipping_method.id}",
                          data: ({ "action" => "change->select-all#toggleCheckbox", "select-all-target" => "checkbox" } if shipping_method.frontend?)
                      = shipping_method.name
                      - unless shipping_method.frontend?
                        = "(#{t('.back_end')})"
                    - if @order_cycle.distributors.many?
                      &mdash;
                      %small
                        %em
                          = shipping_method.distributors.map(&:name).join(", ")
              - else
                %p
                  = t('.no_shipping_methods')
          %tr
            %th{ colspan: 2 }= t('.payment_methods')
          %tr
            %td
            %td
              - if payment_methods.any?
                %ul
                  - payment_methods.each do |payment_method|
                    %li
                      = payment_method.name
                      - if @order_cycle.distributors.many?
                        &mdash;
                        %small
                          %em
                            = payment_method.distributors.map(&:name).join(", ")
              - else
                %p
                  = t('.no_payment_methods')

  %div#save-bar
    %div.container
      %div.seven.columns.alpha
        - if @order_cycle.errors.any?
          %h5#status-message.error
            = @order_cycle.errors.to_a.to_sentence
      %div.nine.columns.omega.text-right
        = hidden_field_tag :context, :checkout_options
        = f.submit t('.save'), class: "red", name: :save
        = f.submit t('.save_and_back_to_list'), class: "red", name: :save_and_back_to_list
        %a.button.cancel{ href: main_app.admin_order_cycles_path }
          = t('.cancel')
