= render partial: "/admin/order_cycles/order_cycle_top_buttons"

- content_for :page_title do
  = t :edit_order_cycle

= form_for [main_app, :admin, @order_cycle], html: { class: "order_cycle" } do |f|

  = render 'wizard_progress'

  %fieldset.no-border-bottom
    %legend{ align: 'center'}= t('.checkout_options')

  = hidden_field_tag "order_cycle[selected_shipping_method_ids][]", ""

  .row
    .three.columns
      &nbsp;
    .ten.columns
      %table.checkout-options
        %thead
          %tr
            %th{ colspan: 2 }= t('.shipping_methods')
          - @order_cycle.distributors.each do |distributor|
            - shipping_methods = @order_cycle.attachable_shipping_methods.where("distributor_id = ?", distributor.id)
            %tr
              %td
              %td
                %em= distributor.name
                - shipping_methods.each do |shipping_method|
                  %p
                    %label
                      = check_box_tag "order_cycle[selected_shipping_method_ids][]",
                          shipping_method.id, @order_cycle.shipping_methods.include?(shipping_method),
                          id: "order_cycle_selected_shipping_method_ids_#{shipping_method.id}"
                      = shipping_method.name
                - distributor.shipping_methods.backend.each do |shipping_method|
                  %label.disabled
                    = check_box_tag nil, nil, false, disabled: true
                    = shipping_method.name
                    = "(#{t('.back_end')})"
                - if distributor.shipping_methods.frontend.none?
                  %p
                    = t('.no_shipping_methods')
          %tr
            %th{ colspan: 2 }= t('.payment_methods')
          %tr
            %td
            %td
              - if @order_cycle.attachable_payment_methods.available(:both).any?
                %ul
                  - @order_cycle.attachable_payment_methods.available(:both).each do |payment_method|
                    %li= payment_method.name
              - else
                %p
                  = t('.no_payment_methods')

  %div#save-bar
    %div.container
      %div.seven.columns.alpha
        - if @order_cycle.errors.any?
          %h5#status-message.error
            = @order_cycle.errors.to_a.to_sentence
      %div.nine.columns.omega.text-right
        = hidden_field_tag :context, :checkout_options
        = f.submit t('.save'), class: "red", name: :save
        = f.submit t('.save_and_back_to_list'), class: "red", name: :save_and_back_to_list
        %a.button.cancel{ href: main_app.admin_order_cycles_path }
          = t('.cancel')
